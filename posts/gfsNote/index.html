<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="gfs Note" /><meta name="author" content="BenchengSu" /><meta property="og:locale" content="en_US" /><meta name="description" content="why. component failure is norm rather than exception. files are huge by traditional standards." /><meta property="og:description" content="why. component failure is norm rather than exception. files are huge by traditional standards." /><link rel="canonical" href="https://cheng1621.github.io/posts/gfsNote/" /><meta property="og:url" content="https://cheng1621.github.io/posts/gfsNote/" /><meta property="og:site_name" content="HelloMike" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-26T08:10:10+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="gfs Note" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@BenchengSu" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"why. component failure is norm rather than exception. files are huge by traditional standards.","@type":"BlogPosting","url":"https://cheng1621.github.io/posts/gfsNote/","headline":"gfs Note","dateModified":"2021-06-26T08:10:10+08:00","datePublished":"2021-06-26T08:10:10+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://cheng1621.github.io/posts/gfsNote/"},"author":{"@type":"Person","name":"BenchengSu"},"@context":"https://schema.org"}</script><title>gfs Note | HelloMike</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">HelloMike</a></div><div class="site-subtitle font-italic">Try everything.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/cheng1621" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['subencheng','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>gfs Note</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>gfs Note</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Jun 26, 2021, 8:10 AM +0800" > Jun 26 <i class="unloaded">2021-06-26T08:10:10+08:00</i> </span> by <span class="author"> BenchengSu </span></div></div><div class="post-content"><h1 id="why">why.</h1><p>component failure is norm rather than exception.<br /> files are huge by traditional standards.</p><h1 id="design-overview">design overview.</h1><ul><li>suppose the component often fail.<li>make optimation for multi-GB files.<li>for random reads, batch and sort them to advance steadily through files rather than go back and forth.<li>concurrent appendance by multiple clients to a same file is also supported.</ul><h1 id="architecture">architecture.</h1><p>a <code class="language-plaintext highlighter-rouge">master</code> and several <code class="language-plaintext highlighter-rouge">chunkservers</code>.<br /> master maintains all the system metadata, including namespace,location … etc.<br /> neither the client nor the chunkserver caches file data, since the file maybe too large to be cached.</p><h2 id="single-master">Single master.</h2><p>process: client send packets consists of the <code class="language-plaintext highlighter-rouge">file name</code> and <code class="language-plaintext highlighter-rouge">chunk index</code> and the server responds with the locations of the chunk. Then client to one of the replicas for the data. <code class="language-plaintext highlighter-rouge">no more client-master interactions are needed until the information expired</code>.</p><h2 id="chunk-size">Chunk Size.</h2><p>usually 64 MB. advantages:</p><ul><li>reduce client-master interaction. Read and writes on the same file need one interaction.<li>a client is more likely to perform many operations on the same files, it could reduce the network overhead.<li>reduce the metadata which is stored in master.</ul><h2 id="metadata">Metadata.</h2><p>three metadata: <code class="language-plaintext highlighter-rouge">file namespace and chunk namespace</code>, <code class="language-plaintext highlighter-rouge">mapping file to chunk</code> and <code class="language-plaintext highlighter-rouge">locations of chunk's replicas.</code></p><h3 id="in-memory-data-structure">In-memory Data Structure.</h3><p>advantages: easy to scan through master’s state and implement the chunk garbage collection.</p><h3 id="chunk-location">chunk location.</h3><ul><li>easy to request the data at startup.<li>if the chunk is moved or failed, there is no point to maintain all the information.</ul><h3 id="operation-log">Operation Log.</h3><p>replicate operation log on mutiple remote machines and respond to a client operation after flushing the OL to disk both locally and remotely.</p><h2 id="consistency-model">Consistency Model.</h2><h3 id="guarantee-by-gfs">guarantee by GFS.</h3><p>some terminology: <code class="language-plaintext highlighter-rouge">defined</code>, <code class="language-plaintext highlighter-rouge">consistent</code>.<br /> GFS identifies failed chunkserver by checksumming.</p><h3 id="implication-for-applications">implication for applications.</h3><p>application mutates file by appending rather than overwriting. that means, a writer generates a file from begining to end.</p><h1 id="system-interaction">system interaction.</h1><p>master granted a <code class="language-plaintext highlighter-rouge">lease</code> to one of the replicas, named <code class="language-plaintext highlighter-rouge">primary</code>. primary define a mutation order. Sometimes primary could revoke the lease to disable the mutation on a file.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>1. client send requests to master for metadata of the chunk.  
2. client push data to replicas.
3. after the step 2, client send write request to primary.
4. primary forward write request to secondary replica.
5. secondary replies to primary.
6. primary replies to client.  
</pre></table></code></div></div><h2 id="data-flow">data flow.</h2><p>to avoid network latency, one server send the information to closest server, instead of <code class="language-plaintext highlighter-rouge">tree topology</code>.</p><h2 id="atomic-record-appends">atomic Record appends.</h2><p>GFS only guarantee the data is written at least once as an atomic unit, which means that data could include duplicate records.</p><h2 id="snapshot">snapshot.</h2><p><code class="language-plaintext highlighter-rouge">copy on write</code></p><h1 id="master-operation">master operation.</h1><h2 id="namespace-management-and-locking">namespace management and locking.</h2><p>GFS does not have a per-directory data structure that lists all the files in directory, nor does it support aliases.</p><h2 id="replica-placement">Replica Placement.</h2><h2 id="creation-re-replication-reblancing">Creation, Re-replication, reblancing.</h2><h2 id="garbage-collection">garbage collection.</h2><p>instead of reclaiming the delete object, the file changed to hidden object.</p><h2 id="stale-replica-detection">stale replica detection.</h2><p>chunk version number is needed.</p><h1 id="fault-tolerance-and-diagnosis">fault tolerance and diagnosis.</h1><h2 id="high-availability">high availability</h2><p><code class="language-plaintext highlighter-rouge">fast recovery</code>, <code class="language-plaintext highlighter-rouge">chunk replication</code> and <code class="language-plaintext highlighter-rouge">master replication</code>.<br /> if master is down, <code class="language-plaintext highlighter-rouge">shadow master</code> provides read-only access to the file system.</p><h2 id="data-integrity">data integrity.</h2><p>checksumming.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/distributed-system/'>Distributed System</a>, <a href='/categories/mit-6824/'>MIT 6824</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/distributed-system/" class="post-tag no-text-decoration" >Distributed System</a> <a href="/tags/gfs/" class="post-tag no-text-decoration" >gfs</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=gfs Note - HelloMike&url=https://cheng1621.github.io/posts/gfsNote/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=gfs Note - HelloMike&u=https://cheng1621.github.io/posts/gfsNote/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=gfs Note - HelloMike&url=https://cheng1621.github.io/posts/gfsNote/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/DailyTrack/">Daily track</a><li><a href="/posts/application/">Application for jobs</a><li><a href="/posts/computer_network_note/">Computer Network Note</a><li><a href="/posts/design_pattern/">Design Pattern Note</a><li><a href="/posts/fault-tolerant-system/">6.824 (假设能拿到offer的项目）</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/distributed-system/">Distributed System</a> <a class="post-tag" href="/tags/raft/">Raft</a> <a class="post-tag" href="/tags/large-scale-software-engineering/">Large Scale Software Engineering</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/application/">application</a> <a class="post-tag" href="/tags/aurora/">Aurora</a> <a class="post-tag" href="/tags/craq/">CRAQ</a> <a class="post-tag" href="/tags/gfs/">gfs</a> <a class="post-tag" href="/tags/kvservice/">kvservice</a> <a class="post-tag" href="/tags/llvm-compiler/">LLVM compiler</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/spanner/"><div class="card-body"> <span class="timeago small" > Mar 10 <i class="unloaded">2021-03-10T16:49:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Spanner</h3><div class="text-muted small"><p> Introduction. a database that shards data across Paxos state machine in data center. Features. application can specify constraints to control which datacenter contain which data. provide exter...</p></div></div></a></div><div class="card"> <a href="/posts/firstPost/"><div class="card-body"> <span class="timeago small" > Nov 24, 2020 <i class="unloaded">2020-11-24T16:29:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>6.824 Lab1 MapReduce</h3><div class="text-muted small"><p> Preparation MapReduce Paper Lab1 Summary Lab1 is to implement a Worker process and a Master process. Whole process: go build -buildmode=plugin ../mrapps/wc.go first build word-count plug...</p></div></div></a></div><div class="card"> <a href="/posts/6824_lab3A/"><div class="card-body"> <span class="timeago small" > Jan 15 <i class="unloaded">2021-01-15T09:46:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>6.824 lab3A</h3><div class="text-muted small"><p> Summary Lab3A require us to implement 3 api: put,append and get. we should maintain linearizability. linearizability: if append: a-&gt;13 is executed before get: a, get should return 13. To avoid t...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/computer_network_note/" class="btn btn-outline-primary"><p>Computer Network Note</p></a> <a href="/posts/application/" class="btn btn-outline-primary"><p>Application for jobs</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/username">BenchengSu</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/distributed-system/">Distributed System</a> <a class="post-tag" href="/tags/raft/">Raft</a> <a class="post-tag" href="/tags/large-scale-software-engineering/">Large Scale Software Engineering</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/application/">application</a> <a class="post-tag" href="/tags/aurora/">Aurora</a> <a class="post-tag" href="/tags/craq/">CRAQ</a> <a class="post-tag" href="/tags/gfs/">gfs</a> <a class="post-tag" href="/tags/kvservice/">kvservice</a> <a class="post-tag" href="/tags/llvm-compiler/">LLVM compiler</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://cheng1621.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); </script>
