<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="6.824 Lab2C" /><meta name="author" content="BenchengSu" /><meta property="og:locale" content="en_US" /><meta name="description" content="Summary. I am a new programmer in Go languare. I spent almost 1 month implementing this lab2. Actually, I spent most of the time on debugging, just because I do not know much about Go. For example, I use rf.mu.Lock many times everywhere in raft.go. it is easier to go wrong because every goroutine can come to work when one Lock is release. This can result in some situations that a parameter change to another one value before you read it. when I am implementing lab2B, there is something wrong with lab2A code, and when I implement lab2C, there is something wrong with lab2B. LOL. My suggestion is if you struggle in some place and cannot find solution on the Internet, you can try detect the goroutine, or you can use sync.Cond in the code." /><meta property="og:description" content="Summary. I am a new programmer in Go languare. I spent almost 1 month implementing this lab2. Actually, I spent most of the time on debugging, just because I do not know much about Go. For example, I use rf.mu.Lock many times everywhere in raft.go. it is easier to go wrong because every goroutine can come to work when one Lock is release. This can result in some situations that a parameter change to another one value before you read it. when I am implementing lab2B, there is something wrong with lab2A code, and when I implement lab2C, there is something wrong with lab2B. LOL. My suggestion is if you struggle in some place and cannot find solution on the Internet, you can try detect the goroutine, or you can use sync.Cond in the code." /><link rel="canonical" href="https://cheng1621.github.io/posts/6824-lab2C/" /><meta property="og:url" content="https://cheng1621.github.io/posts/6824-lab2C/" /><meta property="og:site_name" content="HelloMike" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-28T21:24:10+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="6.824 Lab2C" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@BenchengSu" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Summary. I am a new programmer in Go languare. I spent almost 1 month implementing this lab2. Actually, I spent most of the time on debugging, just because I do not know much about Go. For example, I use rf.mu.Lock many times everywhere in raft.go. it is easier to go wrong because every goroutine can come to work when one Lock is release. This can result in some situations that a parameter change to another one value before you read it. when I am implementing lab2B, there is something wrong with lab2A code, and when I implement lab2C, there is something wrong with lab2B. LOL. My suggestion is if you struggle in some place and cannot find solution on the Internet, you can try detect the goroutine, or you can use sync.Cond in the code.","@type":"BlogPosting","url":"https://cheng1621.github.io/posts/6824-lab2C/","headline":"6.824 Lab2C","dateModified":"2020-12-28T21:24:10+08:00","datePublished":"2020-12-28T21:24:10+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://cheng1621.github.io/posts/6824-lab2C/"},"author":{"@type":"Person","name":"BenchengSu"},"@context":"https://schema.org"}</script><title>6.824 Lab2C | HelloMike</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">HelloMike</a></div><div class="site-subtitle font-italic">Try everything.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/cheng1621" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['subencheng','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>6.824 Lab2C</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>6.824 Lab2C</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Dec 28, 2020, 9:24 PM +0800" > Dec 28, 2020 <i class="unloaded">2020-12-28T21:24:10+08:00</i> </span> by <span class="author"> BenchengSu </span></div></div><div class="post-content"><h1 id="summary">Summary.</h1><p>I am a new programmer in Go languare. I spent almost 1 month implementing this lab2. Actually, I spent most of the time on debugging, just because I do not know much about Go. For example, I use <code class="language-plaintext highlighter-rouge">rf.mu.Lock</code> many times everywhere in <code class="language-plaintext highlighter-rouge">raft.go</code>. it is easier to go wrong because every goroutine can come to work when one Lock is release. This can result in some situations that a parameter change to another one value before you read it. when I am implementing lab2B, there is something wrong with lab2A code, and when I implement lab2C, there is something wrong with lab2B. LOL. My suggestion is if you struggle in some place and cannot find solution on the Internet, you can try detect the goroutine, or you can use <code class="language-plaintext highlighter-rouge">sync.Cond</code> in the code.</p><h1 id="result">Result:</h1><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://raw.githubusercontent.com/cheng1621/HelloMike.github.io/master/assets/img/sample/6824_lab2C_result.png" alt="Result" /></p><h1 id="code">Code:</h1><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>func (rf *Raft) persist() {
	// Your code here (2C).
	// Example:
	w := new(bytes.Buffer)
	e := labgob.NewEncoder(w)
	e.Encode(rf.CurrentTerm)
	e.Encode(rf.VoteFor)
	e.Encode(rf.Log)
	data := w.Bytes()
	rf.persister.SaveRaftState(data)
}
func (rf *Raft) readPersist(data []byte) {
	if data == nil || len(data) &lt; 1 { // bootstrap without any state?
		return
	}
	// Your code here (2C).
	// Example:
	r := bytes.NewBuffer(data)
	d := labgob.NewDecoder(r)
	var term int
	var votefor int
	var log []LogEntry
	if d.Decode(&amp;term) != nil ||
	   d.Decode(&amp;votefor) != nil ||
	   d.Decode(&amp;log) != nil {
	  return
	} else {
	  rf.CurrentTerm = term
	  rf.VoteFor = votefor
	  rf.Log = log
	}
}
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/distributed-system/'>Distributed System</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/distributed-system/" class="post-tag no-text-decoration" >Distributed System</a> <a href="/tags/raft/" class="post-tag no-text-decoration" >Raft</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=6.824 Lab2C - HelloMike&url=https://cheng1621.github.io/posts/6824-lab2C/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=6.824 Lab2C - HelloMike&u=https://cheng1621.github.io/posts/6824-lab2C/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=6.824 Lab2C - HelloMike&url=https://cheng1621.github.io/posts/6824-lab2C/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/DailyTrack/">Daily track</a><li><a href="/posts/application/">Application for jobs</a><li><a href="/posts/computer_network_note/">Computer Network Note</a><li><a href="/posts/design_pattern/">Design Pattern Note</a><li><a href="/posts/fault-tolerant-system/">6.824 (假设能拿到offer的项目）</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/distributed-system/">Distributed System</a> <a class="post-tag" href="/tags/raft/">Raft</a> <a class="post-tag" href="/tags/large-scale-software-engineering/">Large Scale Software Engineering</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/application/">application</a> <a class="post-tag" href="/tags/aurora/">Aurora</a> <a class="post-tag" href="/tags/craq/">CRAQ</a> <a class="post-tag" href="/tags/gfs/">gfs</a> <a class="post-tag" href="/tags/kvservice/">kvservice</a> <a class="post-tag" href="/tags/llvm-compiler/">LLVM compiler</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/6824-lab2D/"><div class="card-body"> <span class="timeago small" > Apr 22 <i class="unloaded">2021-04-22T19:10:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>6.824 lab2D</h3><div class="text-muted small"><p> Summary Log in Raft cannot grow without bound, since long Log occupies space and takes time to replay. Snapshotting is a simplest approach to compaction. Some explanations. every servers take s...</p></div></div></a></div><div class="card"> <a href="/posts/fault-system-system-v2/"><div class="card-body"> <span class="timeago small" > May 29 <i class="unloaded">2021-05-29T09:19:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>6.824</h3><div class="text-muted small"><p> 情景：任何服务器都有可能在没有通知的情况下死机，并且一台服务器处理会造成超载，出现故障后可容错性和可恢复性差。 任务：实现一个K/V集群，支持动态扩缩容,负载均衡,线性一致性, 可容错 和 可恢复。 流程：client 请求 Shard controller 获取当前的配置，把请求发到对应的物理节点，物理节点把请求放到对应的raft状态机中，直到状态机commit后返回结果给client。 ...</p></div></div></a></div><div class="card"> <a href="/posts/fault-tolerant-system/"><div class="card-body"> <span class="timeago small" > Jun 1 <i class="unloaded">2021-06-01T19:10:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>6.824 (假设能拿到offer的项目）</h3><div class="text-muted small"><p> 1.先来个自我介绍吧。 嗯嗯，我之前写过一个基于LLVM的小型编译器，写过一个小型操作系统的kernel，最近写过一个有关分布式系统的，这个分布式系统实际上就是一个可容错性的分布式key/value数据库，支持动态扩容，负载均衡，线性一致性，这个一致性是基于raft共识算法，嗯，raft 就是为了在不同的服务器保持一致性的一种算法。这个数据库支持一定的容错，就是一个服务器崩了，另一个服务器马...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/6824-lab2B/" class="btn btn-outline-primary"><p>6.824 Lab2B</p></a> <a href="/posts/raft/" class="btn btn-outline-primary"><p>Raft note</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/username">BenchengSu</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/distributed-system/">Distributed System</a> <a class="post-tag" href="/tags/raft/">Raft</a> <a class="post-tag" href="/tags/large-scale-software-engineering/">Large Scale Software Engineering</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/application/">application</a> <a class="post-tag" href="/tags/aurora/">Aurora</a> <a class="post-tag" href="/tags/craq/">CRAQ</a> <a class="post-tag" href="/tags/gfs/">gfs</a> <a class="post-tag" href="/tags/kvservice/">kvservice</a> <a class="post-tag" href="/tags/llvm-compiler/">LLVM compiler</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://cheng1621.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); </script>
